<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Moving Window Functions — step_window • recipes</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">recipes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/Simple_Example.html">Simple Example</a>
</li>
<li>
  <a href="../articles/Selecting_Variables.html">Selecting Variables</a>
</li>
<li>
  <a href="../articles/Custom_Steps.html">Custom Steps</a>
</li>
<li>
  <a href="../articles/Ordering.html">The Order of Steps</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/topepo/recipes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Moving Window Functions</h1>
    </div>

    
    <p><code>step_window</code> creates a <em>specification</em> of a recipe step that will
  create new columns that are the results of functions that compute
  statistics across moving windows.</p>
    

    <pre class="usage"><span class='fu'>step_window</span>(<span class='no'>recipe</span>, <span class='no'>...</span>, <span class='kw'>role</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>trained</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>statistic</span> <span class='kw'>=</span> <span class='st'>"mean"</span>, <span class='kw'>names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>recipe</th>
      <td><p>A recipe object. The step will be added to the sequence of 
operations for this recipe.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>One or more selector functions to choose which variables are 
affected by the step. See <code><a href='selections.html'>selections</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>role</th>
      <td><p>For model terms created by this step, what analysis role should
they be assigned? If <code>names</code> is left to be <code>NULL</code>, the rolling
statistics replace the original columns and the roles are left unchanged.
If <code>names</code> is set, those new columns will have a role of <code>NULL</code>
unless this argument has a value.</p></td>
    </tr>
    <tr>
      <th>trained</th>
      <td><p>A logical to indicate if the quantities for preprocessing 
have been estimated.</p></td>
    </tr>
    <tr>
      <th>size</th>
      <td><p>An odd integer <code>&gt;= 3</code> for the window size.</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>A logical for whether missing values should be removed from the
calculations within each window.</p></td>
    </tr>
    <tr>
      <th>statistic</th>
      <td><p>A character string for the type of statistic that should
be calculated for each moving window. Possible values are: <code>'max'</code>,
<code>'mean'</code>, <code>'median'</code>, <code>'min'</code>, <code>'prod'</code>, <code>'sd'</code>,
<code>'sum'</code>, <code>'var'</code></p></td>
    </tr>
    <tr>
      <th>names</th>
      <td><p>An optional character string that is the same length of the
number of terms selected by <code>terms</code>. If you are not sure what columns
will be selected, use the <code>summary</code> function (see the example below).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>step_window</code> returns an object of class <code>step_window</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The calculations use a somewhat atypical method for handling the
  beginning and end parts of the rolling statistics. The process starts
  with the center justified window calculations and the beginning and
  ending parts of the rolling values are determined using the first and
  last rolling values, respectively. For example if a column <code>x</code> with
  12 values is smoothed with a 5-point moving median, the first three
  smoothed values are estimated by <code>median(x[1:5])</code> and the fourth
  uses <code>median(x[2:6])</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>recipes</span>)
<span class='fu'>library</span>(<span class='no'>dplyr</span>)
<span class='fu'>library</span>(<span class='no'>rlang</span>)
<span class='fu'>library</span>(<span class='no'>ggplot2</span>, <span class='kw'>quietly</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>set.seed</span>(<span class='fl'>5522</span>)
<span class='no'>sim_dat</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>x1</span> <span class='kw'>=</span> (<span class='fl'>20</span>:<span class='fl'>100</span>) / <span class='fl'>10</span>)
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'>nrow</span>(<span class='no'>sim_dat</span>)
<span class='no'>sim_dat</span>$<span class='no'>y1</span> <span class='kw'>&lt;-</span> <span class='fu'>sin</span>(<span class='no'>sim_dat</span>$<span class='no'>x1</span>) + <span class='fu'>rnorm</span>(<span class='no'>n</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)
<span class='no'>sim_dat</span>$<span class='no'>y2</span> <span class='kw'>&lt;-</span> <span class='fu'>cos</span>(<span class='no'>sim_dat</span>$<span class='no'>x1</span>) + <span class='fu'>rnorm</span>(<span class='no'>n</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)
<span class='no'>sim_dat</span>$<span class='no'>x2</span> <span class='kw'>&lt;-</span> <span class='fu'>runif</span>(<span class='no'>n</span>)
<span class='no'>sim_dat</span>$<span class='no'>x3</span> <span class='kw'>&lt;-</span> <span class='fu'>rnorm</span>(<span class='no'>n</span>)

<span class='no'>rec</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='recipe.html'>recipe</a></span>(<span class='no'>y1</span> + <span class='no'>y2</span> ~ <span class='no'>x1</span> + <span class='no'>x2</span> + <span class='no'>x3</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>sim_dat</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>step_window</span>(<span class='fu'>starts_with</span>(<span class='st'>"y"</span>), <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>7</span>, <span class='kw'>statistic</span> <span class='kw'>=</span> <span class='st'>"median"</span>,
              <span class='kw'>names</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='st'>"med_7pt_"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>),
              <span class='kw'>role</span> <span class='kw'>=</span> <span class='st'>"outcome"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>step_window</span>(<span class='fu'>starts_with</span>(<span class='st'>"y"</span>),
              <span class='kw'>names</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='st'>"mean_3pt_"</span>, <span class='fl'>1</span>:<span class='fl'>2</span>),
              <span class='kw'>role</span> <span class='kw'>=</span> <span class='st'>"outcome"</span>)
<span class='no'>rec</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='prepare.html'>prepare</a></span>(<span class='no'>rec</span>, <span class='kw'>training</span> <span class='kw'>=</span> <span class='no'>sim_dat</span>)</div><div class='output co'>#&gt; step 1 window training 
#&gt; step 2 window training </div><div class='input'>
<span class='co'># If you aren't sure how to set the names, see which variables are selected</span>
<span class='co'># and the order that they are selected:</span>
<span class='fu'><a href='terms_select.html'>terms_select</a></span>(<span class='kw'>info</span> <span class='kw'>=</span> <span class='fu'>summary</span>(<span class='no'>rec</span>), <span class='kw'>terms</span> <span class='kw'>=</span> <span class='fu'>quos</span>(<span class='fu'>starts_with</span>(<span class='st'>"y"</span>)))</div><div class='output co'>#&gt; [1] "y1" "y2"</div><div class='input'>
<span class='no'>smoothed_dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bake.html'>bake</a></span>(<span class='no'>rec</span>, <span class='no'>sim_dat</span>, <span class='fu'>everything</span>())

<span class='fu'>ggplot</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>sim_dat</span>, <span class='fu'>aes</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x1</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y1</span>)) +
  <span class='fu'>geom_point</span>() +
  <span class='fu'>geom_line</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>smoothed_dat</span>, <span class='fu'>aes</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>med_7pt_1</span>)) +
  <span class='fu'>geom_line</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>smoothed_dat</span>, <span class='fu'>aes</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>mean_3pt_1</span>), <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>) +
  <span class='fu'>theme_bw</span>()</div><img src='step_window-6.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'># If you want to replace the selected variables with the rolling statistic</span>
<span class='co'># don't set `names`</span>
<span class='no'>sim_dat</span>$<span class='no'>original</span> <span class='kw'>&lt;-</span> <span class='no'>sim_dat</span>$<span class='no'>y1</span>
<span class='no'>rec</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='recipe.html'>recipe</a></span>(<span class='no'>y1</span> + <span class='no'>y2</span> + <span class='no'>original</span> ~ <span class='no'>x1</span> + <span class='no'>x2</span> + <span class='no'>x3</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>sim_dat</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>step_window</span>(<span class='fu'>starts_with</span>(<span class='st'>"y"</span>))
<span class='no'>rec</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='prepare.html'>prepare</a></span>(<span class='no'>rec</span>, <span class='kw'>training</span> <span class='kw'>=</span> <span class='no'>sim_dat</span>)</div><div class='output co'>#&gt; step 1 window training </div><div class='input'><span class='no'>smoothed_dat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bake.html'>bake</a></span>(<span class='no'>rec</span>, <span class='no'>sim_dat</span>, <span class='fu'>everything</span>())
<span class='fu'>ggplot</span>(<span class='no'>smoothed_dat</span>, <span class='fu'>aes</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>original</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y1</span>)) +
  <span class='fu'>geom_point</span>() +
  <span class='fu'>theme_bw</span>()</div><img src='step_window-10.png' alt='' width='540' height='400' /></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Max Kuhn, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
