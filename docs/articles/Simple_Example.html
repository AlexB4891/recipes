<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Recipes • recipes</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">recipes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Simple_Example.html">Simple Example</a>
</li>
<li>
  <a href="../articles/Selecting_Variables.html">Selecting Variables</a>
</li>
<li>
  <a href="../articles/Custom_Steps.html">Custom Steps</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/topepo/recipes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Basic Recipes</h1>
            
          </div>

    
    
<div class="contents">
<p>This document demonstrates some basic uses of recipes. First, some definitions are required:</p>
<ul>
<li>
<strong>variables</strong> are the original (raw) data columns in a data frame or tibble. For example, in a traditional formula <code>Y ~ A + B + A:B</code>, the variables are <code>A</code>, <code>B</code>, and <code>Y</code>.</li>
<li>
<strong>roles</strong> define how variables will be used in the model. Examples are: <code>predictor</code> (independent variables), <code>response</code>, and <code>case weight</code>. This is meant to be open-ended and extensible.</li>
<li>
<strong>terms</strong> are columns in a design matrix such as <code>A</code>, <code>B</code>, and <code>A:B</code>. These can be other derived entities that are grouped such a a set of principal components or a set of columns that define a basis function for a variable. These are synonymous with features in machine learning. Variables that have <code>predictor</code> roles would automatically be main effect terms</li>
</ul>
<div id="an-example" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example" class="anchor"></a>An Example</h2>
<p>The cell segmentation data will be used. It has 58 predictor columns, a factor variable <code>Class</code> (the outcome), and two extra labelling columns. Each of the predictors has a suffix for the optical channel (<code>"Ch1"</code>-<code>"Ch4"</code>). We will first separate the data into a training and test set then remove unimportant variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caret)
<span class="kw">data</span>(segmentationData)
<span class="kw">library</span>(dplyr)

seg_train &lt;-<span class="st"> </span>segmentationData <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Case <span class="op">==</span><span class="st"> "Train"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Case, <span class="op">-</span>Cell)
seg_test  &lt;-<span class="st"> </span>segmentationData <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Case <span class="op">==</span><span class="st"> "Test"</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Case, <span class="op">-</span>Cell)</code></pre></div>
<p>The idea is that the preprocessing operations will all be created using the training set and then these steps will be applied to both the training and test set.</p>
</div>
<div id="an-initial-recipe" class="section level2">
<h2 class="hasAnchor">
<a href="#an-initial-recipe" class="anchor"></a>An Initial Recipe</h2>
<p>For a first recipe, let’s plan on centering and scaling the predictors. First, we will create a recipe from the original data and then specify the processing steps.</p>
<p>Recipes can be created manually by sequentially adding roles to variables in a data set.</p>
<p>If the analysis only required <strong>outcomes</strong> and <strong>predictors</strong>, the easiest way to create the initial recipe is to use the standard formula method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(recipes)
rec_obj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recipe.html">recipe</a></span>(Class <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> seg_train)
rec_obj</code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         58</code></pre>
<p>The data contained in the <code>data</code> argument need not be the training set; this data is only used to catalog the names of the variables and their types (e.g. numeric, etc.).</p>
<p>(Note that the formula method here is used to declare the variables and their roles and nothing else. If you use inline functions (e.g. <code>log</code>) it will complain. These types of operations can be added later.)</p>
</div>
<div id="preprocessing-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocessing-steps" class="anchor"></a>Preprocessing Steps</h2>
<p>From here, preprocessing steps can be added sequentially in one of two ways:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rec_obj &lt;-<span class="st"> </span><span class="kw">step_name</span>(rec_obj, arguments)    ## or
rec_obj &lt;-<span class="st"> </span>rec_obj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">step_name</span>(arguments)</code></pre></div>
<p><code>step_center</code> and the other functions will always return updated recipes.</p>
<p>One other important facet of the code is the method for specifying which variables should be used in different steps. The manual page <code><a href="../reference/selections.html">?selections</a></code> has more details but <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html"><code>dplyr</code></a>-like selector functions can be used:</p>
<ul>
<li>use basic variable names (e.g. <code>x1, x2</code>),</li>
<li>
<a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html"><code>dplyr</code></a> functions for selecting variables: <code>contains</code>, <code>ends_with</code>, <code>everything</code>, <code>matches</code>, <code>num_range</code>, and <code>starts_with</code>,</li>
<li>functions that subset on the role of the variables that have been specified so far: <code>all_outcomes</code>, <code>all_predictors</code>, <code>has_role</code>, or</li>
<li>similar functions for the type of data: <code>all_nominal</code>, <code>all_numeric</code>, and <code>has_type</code>.</li>
</ul>
<p>Note that the functions listed above are the only ones that can be used to selecto variables inside the steps. Also, minus signs can be used to deselect variables.</p>
<p>For our data, we can add the two operations for all of the predictors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">standardized &lt;-<span class="st"> </span>rec_obj <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/step_center.html">step_center</a></span>(<span class="kw"><a href="../reference/has_role.html">all_predictors</a></span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/step_scale.html">step_scale</a></span>(<span class="kw"><a href="../reference/has_role.html">all_predictors</a></span>()) 
standardized</code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         58
## 
## Steps:
## 
## Centering for all_predictors()
## Scaling for all_predictors()</code></pre>
<p>It is important to realize that the <em>specific</em> variables have not been declared yet (in this example). In some preprocessing steps, variables will be added or removed from the current list of possible variables.</p>
<p>If this is the only processing steps for the predictors, we can now estimate the means and standard deviations from the training set. The <code>learn</code> function is used with a recipe and a data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trained_rec &lt;-<span class="st"> </span><span class="kw"><a href="../reference/learn.html">learn</a></span>(standardized, <span class="dt">training =</span> seg_train)</code></pre></div>
<pre><code>## step 1 center training 
## step 2 scale training</code></pre>
<p>Now that the statistics have been estimated, the processing can be applied to the training and test set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">train_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(trained_rec, <span class="dt">newdata =</span> seg_train)
test_data  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(trained_rec, <span class="dt">newdata =</span> seg_test)</code></pre></div>
<p><code>process</code> returns a tibble:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(test_data)</code></pre></div>
<pre><code>## [1] "tbl_df"     "tbl"        "data.frame"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_data</code></pre></div>
<pre><code>## # A tibble: 1,010 x 58
##       AngleCh1    AreaCh1 AvgIntenCh1 AvgIntenCh2 AvgIntenCh3 AvgIntenCh4
##          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1.06561586 -0.6470674  -0.6841090  -1.1769586  -0.9256508 -0.92379995
##  2 -1.80403073 -0.1852916  -0.6318946  -0.4791016  -0.8088369 -0.66664196
##  3 -1.02997656 -0.7070983   1.2073287   3.0354287   0.3481220  1.38644713
##  4  1.69348204 -0.6840095   0.8056903   2.6640591   0.2962628  0.89335632
##  5  1.81293423 -0.3422954  -0.6681004  -1.1719298  -0.8434861 -0.92822767
##  6 -1.47591871  0.7844377  -0.6820300  -0.6280328  -0.8810829 -0.59391141
##  7  1.27016162  0.2718665  -0.6717198  -0.6251114  -0.8091589 -0.51558489
##  8 -1.58365831  0.4565769   0.2831505   1.3198321  -0.6133099 -0.08913901
##  9 -0.79573603 -0.4115617  -0.6689980  -1.1680446  -0.8450346 -0.92583231
## 10  0.03629088 -0.6378319  -0.5345582   0.1818292  -0.5552296 -0.02530285
## # ... with 1,000 more rows, and 52 more variables:
## #   ConvexHullAreaRatioCh1 &lt;dbl&gt;, ConvexHullPerimRatioCh1 &lt;dbl&gt;,
## #   DiffIntenDensityCh1 &lt;dbl&gt;, DiffIntenDensityCh3 &lt;dbl&gt;,
## #   DiffIntenDensityCh4 &lt;dbl&gt;, EntropyIntenCh1 &lt;dbl&gt;,
## #   EntropyIntenCh3 &lt;dbl&gt;, EntropyIntenCh4 &lt;dbl&gt;, EqCircDiamCh1 &lt;dbl&gt;,
## #   EqEllipseLWRCh1 &lt;dbl&gt;, EqEllipseOblateVolCh1 &lt;dbl&gt;,
## #   EqEllipseProlateVolCh1 &lt;dbl&gt;, EqSphereAreaCh1 &lt;dbl&gt;,
## #   EqSphereVolCh1 &lt;dbl&gt;, FiberAlign2Ch3 &lt;dbl&gt;, FiberAlign2Ch4 &lt;dbl&gt;,
## #   FiberLengthCh1 &lt;dbl&gt;, FiberWidthCh1 &lt;dbl&gt;, IntenCoocASMCh3 &lt;dbl&gt;,
## #   IntenCoocASMCh4 &lt;dbl&gt;, IntenCoocContrastCh3 &lt;dbl&gt;,
## #   IntenCoocContrastCh4 &lt;dbl&gt;, IntenCoocEntropyCh3 &lt;dbl&gt;,
## #   IntenCoocEntropyCh4 &lt;dbl&gt;, IntenCoocMaxCh3 &lt;dbl&gt;,
## #   IntenCoocMaxCh4 &lt;dbl&gt;, KurtIntenCh1 &lt;dbl&gt;, KurtIntenCh3 &lt;dbl&gt;,
## #   KurtIntenCh4 &lt;dbl&gt;, LengthCh1 &lt;dbl&gt;, NeighborAvgDistCh1 &lt;dbl&gt;,
## #   NeighborMinDistCh1 &lt;dbl&gt;, NeighborVarDistCh1 &lt;dbl&gt;, PerimCh1 &lt;dbl&gt;,
## #   ShapeBFRCh1 &lt;dbl&gt;, ShapeLWRCh1 &lt;dbl&gt;, ShapeP2ACh1 &lt;dbl&gt;,
## #   SkewIntenCh1 &lt;dbl&gt;, SkewIntenCh3 &lt;dbl&gt;, SkewIntenCh4 &lt;dbl&gt;,
## #   SpotFiberCountCh3 &lt;dbl&gt;, SpotFiberCountCh4 &lt;dbl&gt;, TotalIntenCh1 &lt;dbl&gt;,
## #   TotalIntenCh2 &lt;dbl&gt;, TotalIntenCh3 &lt;dbl&gt;, TotalIntenCh4 &lt;dbl&gt;,
## #   VarIntenCh1 &lt;dbl&gt;, VarIntenCh3 &lt;dbl&gt;, VarIntenCh4 &lt;dbl&gt;,
## #   WidthCh1 &lt;dbl&gt;, XCentroid &lt;dbl&gt;, YCentroid &lt;dbl&gt;</code></pre>
</div>
<div id="adding-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-steps" class="anchor"></a>Adding Steps</h2>
<p>After exploring the data, more preprocessing might be required. Steps can be added to the trained recipe. Suppose that we need to create PCA components but only from the predictors from channel 1 and any predictors that are areas:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trained_rec &lt;-<span class="st"> </span>trained_rec <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/step_pca.html">step_pca</a></span>(<span class="kw">ends_with</span>(<span class="st">"Ch1"</span>), <span class="kw">contains</span>(<span class="st">"area"</span>), <span class="dt">num =</span> <span class="dv">5</span>)
trained_rec</code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         58
## 
## Training data contained 1009 data points and no missing data.
## 
## Steps:
## 
## Centering for AngleCh1, AreaCh1, ... [trained]
## Scaling for AngleCh1, AreaCh1, ... [trained]
## PCA extraction with ends_with("Ch1"), contains("area")</code></pre>
<p>Note that only the last step has been estimated; the first two were previously trained and these activities are not duplicated. We can add the PCA estimates using <code>learn</code> again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trained_rec &lt;-<span class="st"> </span><span class="kw"><a href="../reference/learn.html">learn</a></span>(trained_rec, <span class="dt">training =</span> seg_train)</code></pre></div>
<pre><code>## step 1 center [pre-trained]
## step 2 scale [pre-trained]
## step 3 pca training</code></pre>
<p><code>process</code> can be reapplied to get the principal components in addition to the other variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_data  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(trained_rec, <span class="dt">newdata =</span> seg_test)
<span class="kw">names</span>(test_data)</code></pre></div>
<pre><code>##  [1] "AvgIntenCh2"          "AvgIntenCh3"          "AvgIntenCh4"         
##  [4] "DiffIntenDensityCh3"  "DiffIntenDensityCh4"  "EntropyIntenCh3"     
##  [7] "EntropyIntenCh4"      "FiberAlign2Ch3"       "FiberAlign2Ch4"      
## [10] "IntenCoocASMCh3"      "IntenCoocASMCh4"      "IntenCoocContrastCh3"
## [13] "IntenCoocContrastCh4" "IntenCoocEntropyCh3"  "IntenCoocEntropyCh4" 
## [16] "IntenCoocMaxCh3"      "IntenCoocMaxCh4"      "KurtIntenCh3"        
## [19] "KurtIntenCh4"         "SkewIntenCh3"         "SkewIntenCh4"        
## [22] "SpotFiberCountCh3"    "SpotFiberCountCh4"    "TotalIntenCh2"       
## [25] "TotalIntenCh3"        "TotalIntenCh4"        "VarIntenCh3"         
## [28] "VarIntenCh4"          "XCentroid"            "YCentroid"           
## [31] "PC1"                  "PC2"                  "PC3"                 
## [34] "PC4"                  "PC5"</code></pre>
<p>Note that the PCA components have replaced the original variables that were from channel 1 or measured an area aspect of the cells.</p>
<p>There are a number of different steps included in the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">steps &lt;-<span class="st"> </span><span class="kw">apropos</span>(<span class="st">"^step_"</span>)
steps[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">"new$"</span>, steps)]</code></pre></div>
<pre><code>##  [1] "step_bagimpute"   "step_bin2factor"  "step_BoxCox"     
##  [4] "step_center"      "step_classdist"   "step_corr"       
##  [7] "step_date"        "step_depth"       "step_discretize" 
## [10] "step_dummy"       "step_holiday"     "step_hyperbolic" 
## [13] "step_ica"         "step_interact"    "step_invlogit"   
## [16] "step_isomap"      "step_kpca"        "step_lincomb"    
## [19] "step_log"         "step_logit"       "step_meanimpute" 
## [22] "step_modeimpute"  "step_ns"          "step_nzv"        
## [25] "step_other"       "step_pca"         "step_poly"       
## [28] "step_range"       "step_ratio"       "step_regex"      
## [31] "step_rm"          "step_scale"       "step_shuffle"    
## [34] "step_spatialsign" "step_sqrt"        "step_YeoJohnson"</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#an-example">An Example</a></li>
      <li><a href="#an-initial-recipe">An Initial Recipe</a></li>
      <li><a href="#preprocessing-steps">Preprocessing Steps</a></li>
      <li><a href="#adding-steps">Adding Steps</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Max Kuhn, <a href="http://hadley.nz">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
